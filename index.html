<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kids Reading Adventure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            touch-action: manipulation;
            transition: background-color 0.3s ease;
        }
        .kids-font { font-family: 'Fredoka One', cursive; }
        .btn-bounce:active { transform: scale(0.9); }
        .listen-pulse { animation: pulse-red 1.5s infinite; }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); transform: scale(1); }
            70% { box-shadow: 0 0 0 20px rgba(239, 68, 68, 0); transform: scale(1.05); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); transform: scale(1); }
        }
    </style>
</head>
<body class="bg-blue-50 dark:bg-slate-900 flex flex-col items-center justify-center min-h-screen p-4 overflow-hidden select-none transition-colors duration-300">

    <!-- Top Toolbar -->
    <div class="fixed top-4 w-full max-w-2xl px-6 flex justify-between items-center z-20 gap-2">
        <div class="flex gap-2">
            <div class="bg-white dark:bg-slate-800 rounded-full px-4 py-2 shadow-md border-2 border-yellow-400">
                <span class="text-lg font-bold text-yellow-600 dark:text-yellow-400" id="progressText">1 / 100</span>
            </div>
            <div class="bg-white dark:bg-slate-800 rounded-full px-4 py-2 shadow-md border-2 border-green-400">
                <span class="text-lg font-bold text-green-600 dark:text-green-400">‚≠ê <span id="starCount">0</span></span>
            </div>
        </div>

        <div class="flex gap-2">
            <button onclick="changeFontSize(-10)" class="bg-white dark:bg-slate-800 p-2 rounded-full shadow-md border-2 border-blue-400 text-blue-500 font-bold hover:bg-blue-50 dark:hover:bg-slate-700">A-</button>
            <button onclick="changeFontSize(10)" class="bg-white dark:bg-slate-800 p-2 rounded-full shadow-md border-2 border-blue-400 text-blue-500 font-bold hover:bg-blue-50 dark:hover:bg-slate-700">A+</button>
            <button onclick="toggleTheme()" class="bg-white dark:bg-slate-800 p-2 rounded-full shadow-md border-2 border-purple-400 text-purple-500 dark:text-purple-400" id="themeBtn">
                <svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M6.343 6.343l-.707-.707M12 8a4 4 0 100 8 4 4 0 000-8z" />
                </svg>
            </button>
        </div>
    </div>

    <!-- Main Game Area -->
    <main class="w-full max-w-lg bg-white dark:bg-slate-800 rounded-3xl shadow-2xl p-6 border-b-8 border-gray-200 dark:border-slate-950 relative mt-12 transition-colors duration-300">
        
        <!-- Category Badge -->
        <div class="flex justify-center mb-4">
            <div id="categoryBadge" class="bg-purple-500 text-white px-6 py-1 rounded-full text-lg font-bold shadow-md">
                CH Sound
            </div>
        </div>

        <!-- Word Display -->
        <div id="wordCard" class="flex flex-col items-center justify-center min-h-[250px] mb-6">
            <h1 id="mainWord" class="kids-font tracking-wide mb-2 text-center break-all">back</h1>
            <p id="feedbackText" class="text-xl font-bold text-gray-400 dark:text-gray-500 text-center px-4 h-14 flex items-center">Listen, then try saying it!</p>
        </div>

        <!-- Interaction Buttons -->
        <div class="grid grid-cols-2 gap-4 mb-6">
            <button onclick="listenToWord()" class="btn-bounce flex flex-col items-center justify-center bg-orange-400 hover:bg-orange-500 text-white rounded-2xl py-6 shadow-lg border-b-4 border-orange-600 transition-all">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                </svg>
                <span class="text-lg font-bold uppercase">Listen</span>
            </button>

            <button id="speakBtn" onclick="handleMicClick()" class="btn-bounce flex flex-col items-center justify-center bg-red-400 hover:bg-red-500 text-white rounded-2xl py-6 shadow-lg border-b-4 border-red-600 transition-all relative">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                </svg>
                <span id="micBtnText" class="text-lg font-bold uppercase">Say it</span>
            </button>
        </div>

        <!-- Navigation -->
        <div class="flex items-center justify-between gap-4">
            <button onclick="prevWord()" class="btn-bounce bg-gray-200 dark:bg-slate-700 hover:bg-gray-300 dark:hover:bg-slate-600 text-gray-600 dark:text-gray-300 rounded-full p-4 flex-1 font-bold text-xl border-b-4 border-gray-400 dark:border-slate-950">
                BACK
            </button>
            <button onclick="nextWord()" class="btn-bounce bg-blue-500 hover:bg-blue-600 text-white rounded-full p-4 flex-[2] font-bold text-xl shadow-lg border-b-4 border-blue-700">
                NEXT WORD
            </button>
        </div>
    </main>

    <!-- Success Message Box -->
    <div id="modal" class="fixed inset-0 bg-black/60 hidden flex items-center justify-center z-50 p-4 backdrop-blur-sm">
        <div class="bg-white dark:bg-slate-800 rounded-3xl p-8 max-w-sm w-full text-center shadow-2xl scale-0 transition-transform duration-300" id="modalContent">
            <div class="text-6xl mb-4">üéâ</div>
            <h2 class="kids-font text-3xl text-green-600 dark:text-green-400 mb-2">Great Job!</h2>
            <p id="modalMsg" class="text-xl text-gray-600 dark:text-gray-300 mb-6">You said it perfectly!</p>
            <button onclick="closeModal()" class="w-full bg-green-500 hover:bg-green-600 text-white rounded-2xl py-4 font-bold text-xl shadow-lg border-b-4 border-green-700">
                CONTINUE
            </button>
        </div>
    </div>

    <script>
        const words = [
            {word: "back", sound: "ck"}, {word: "check", sound: "ck"}, {word: "duck", sound: "ck"}, {word: "luck", sound: "ck"}, {word: "neck", sound: "ck"},
            {word: "pick", sound: "ck"}, {word: "rock", sound: "ck"}, {word: "sock", sound: "ck"}, {word: "sick", sound: "ck"}, {word: "tack", sound: "ck"},
            {word: "black", sound: "ck"}, {word: "clock", sound: "ck"}, {word: "snack", sound: "ck"}, {word: "brick", sound: "ck"}, {word: "truck", sound: "ck"},
            {word: "chat", sound: "ch"}, {word: "chip", sound: "ch"}, {word: "chop", sound: "ch"}, {word: "rich", sound: "ch"}, {word: "much", sound: "ch"},
            {word: "such", sound: "ch"}, {word: "chin", sound: "ch"}, {word: "chess", sound: "ch"}, {word: "bench", sound: "ch"},
            {word: "lunch", sound: "ch"}, {word: "beach", sound: "ch"}, {word: "catch", sound: "ch"}, {word: "match", sound: "ch"}, {word: "patch", sound: "ch"},
            {word: "the", sound: "th"}, {word: "they", sound: "th"}, {word: "this", sound: "th"}, {word: "that", sound: "th"}, {word: "then", sound: "th"},
            {word: "them", sound: "th"}, {word: "with", sound: "th"}, {word: "moth", sound: "th"}, {word: "path", sound: "th"}, {word: "bath", sound: "th"},
            {word: "thin", sound: "th"}, {word: "thick", sound: "th"}, {word: "math", sound: "th"}, {word: "tooth", sound: "th"}, {word: "think", sound: "th"},
            {word: "ship", sound: "sh"}, {word: "shop", sound: "sh"}, {word: "shut", sound: "sh"}, {word: "fish", sound: "sh"}, {word: "dish", sound: "sh"},
            {word: "wish", sound: "sh"}, {word: "rush", sound: "sh"}, {word: "dash", sound: "sh"}, {word: "shell", sound: "sh"}, {word: "shine", sound: "sh"},
            {word: "sheet", sound: "sh"}, {word: "shark", sound: "sh"}, {word: "trash", sound: "sh"}, {word: "brush", sound: "sh"}, {word: "flash", sound: "sh"},
            {word: "when", sound: "wh"}, {word: "whip", sound: "wh"}, {word: "white", sound: "wh"}, {word: "whale", sound: "wh"}, {word: "wheel", sound: "wh"},
            {word: "wheat", sound: "wh"}, {word: "whisk", sound: "wh"}, {word: "while", sound: "wh"}, {word: "which", sound: "wh"}, {word: "whack", sound: "wh"},
            {word: "phone", sound: "ph"}, {word: "photo", sound: "ph"}, {word: "graph", sound: "ph"}, {word: "phase", sound: "ph"}, {word: "phlox", sound: "ph"},
            {word: "dolphin", sound: "ph"}, {word: "trophy", sound: "ph"}, {word: "phantom", sound: "ph"}, {word: "orphan", sound: "ph"}, {word: "sphere", sound: "ph"},
            {word: "ring", sound: "ng"}, {word: "sing", sound: "ng"}, {word: "song", sound: "ng"}, {word: "long", sound: "ng"}, {word: "wing", sound: "ng"},
            {word: "king", sound: "ng"}, {word: "hang", sound: "ng"}, {word: "bang", sound: "ng"}, {word: "lung", sound: "ng"}, {word: "sung", sound: "ng"},
            {word: "quit", sound: "qu"}, {word: "quiz", sound: "qu"}, {word: "quick", sound: "qu"}, {word: "quilt", sound: "qu"}, {word: "queen", sound: "qu"},
            {word: "quack", sound: "qu"}, {word: "quest", sound: "qu"}, {word: "quill", sound: "qu"}, {word: "quart", sound: "qu"}, {word: "quite", sound: "qu"}
        ];

        let currentIndex = 0;
        let stars = 0;
        let currentFontSize = 80;
        let isListening = false;

        const mainWordEl = document.getElementById('mainWord');
        const feedbackEl = document.getElementById('feedbackText');
        const progressEl = document.getElementById('progressText');
        const starEl = document.getElementById('starCount');
        const categoryBadge = document.getElementById('categoryBadge');
        const speakBtn = document.getElementById('speakBtn');
        const micBtnText = document.getElementById('micBtnText');

        // Audio System
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playBeep(freq, type = 'sine', duration = 0.1) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function playStartMic() {
            playBeep(440, 'triangle', 0.2);
            setTimeout(() => playBeep(880, 'triangle', 0.2), 100);
        }

        function playStopMic() {
            playBeep(880, 'triangle', 0.1);
            setTimeout(() => playBeep(440, 'triangle', 0.1), 50);
        }

        function playClick() {
            playBeep(600, 'sine', 0.05);
        }

        // Theme Toggle
        function toggleTheme() {
            playClick();
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            const themeBtn = document.getElementById('themeBtn');
            themeBtn.innerHTML = isDark ? 
                `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>` :
                `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M6.343 6.343l-.707-.707M12 8a4 4 0 100 8 4 4 0 000-8z" /></svg>`;
        }

        function changeFontSize(delta) {
            playClick();
            currentFontSize = Math.max(40, Math.min(currentFontSize + delta, 150));
            mainWordEl.style.fontSize = `${currentFontSize}px`;
        }

        // Speech
        const synth = window.speechSynthesis;
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition = null;

        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'en-US';
            recognition.interimResults = false;
            recognition.maxAlternatives = 5;

            recognition.onresult = (event) => {
                const target = words[currentIndex].word.toLowerCase();
                let foundMatch = false;
                let topResult = "";

                for (let i = 0; i < event.results[0].length; i++) {
                    const transcript = event.results[0][i].transcript.toLowerCase().trim();
                    if (i === 0) topResult = transcript;
                    if (transcript === target || transcript.includes(target)) {
                        foundMatch = true;
                        break;
                    }
                }
                
                if (foundMatch) handleSuccess();
                else handleFailure(topResult);
            };

            recognition.onend = () => {
                if (isListening) playStopMic();
                stopRecognitionUI();
            };

            recognition.onerror = (e) => {
                if(e.error === 'no-speech') feedbackEl.textContent = "I didn't hear anything! Try again.";
                else feedbackEl.textContent = "Mic error. Please try again.";
                stopRecognitionUI();
            };
        }

        function handleMicClick() {
            if (isListening) {
                playStopMic();
                recognition.stop(); // This triggers onresult/onend immediately
            } else {
                startSpeaking();
            }
        }

        function startSpeaking() {
            if (!recognition) {
                feedbackEl.textContent = "Voice not supported in this browser.";
                return;
            }
            playStartMic();
            isListening = true;
            feedbackEl.textContent = "Listening... Tap mic again to finish!";
            feedbackEl.className = "text-xl font-bold text-red-500 animate-pulse text-center px-4 h-14 flex items-center";
            speakBtn.classList.add('listen-pulse');
            micBtnText.textContent = "DONE!";
            recognition.start();
        }

        function stopRecognitionUI() {
            isListening = false;
            speakBtn.classList.remove('listen-pulse');
            micBtnText.textContent = "SAY IT";
        }

        function updateDisplay() {
            const current = words[currentIndex];
            mainWordEl.textContent = current.word;
            mainWordEl.style.fontSize = `${currentFontSize}px`;
            categoryBadge.textContent = `${current.sound.toUpperCase()} Sound`;
            progressEl.textContent = `${currentIndex + 1} / ${words.length}`;
            feedbackEl.textContent = "Listen, then try saying it!";
            feedbackEl.className = "text-xl font-bold text-gray-400 dark:text-gray-500 text-center px-4 h-14 flex items-center";
            
            const colors = ['text-blue-500', 'text-purple-500', 'text-pink-500', 'text-indigo-500'];
            mainWordEl.className = `kids-font tracking-wide mb-2 text-center break-all ${colors[currentIndex % colors.length]}`;
        }

        function listenToWord() {
            playClick();
            if (synth.speaking) synth.cancel();
            const utter = new SpeechSynthesisUtterance(words[currentIndex].word);
            utter.rate = 0.7;
            utter.pitch = 1.2;
            synth.speak(utter);
            mainWordEl.classList.add('scale-110');
            setTimeout(() => mainWordEl.classList.remove('scale-110'), 300);
        }

        function handleSuccess() {
            stars++;
            starEl.textContent = stars;
            feedbackEl.textContent = "Awesome! Correct!";
            feedbackEl.className = "text-xl font-bold text-green-500 text-center px-4 h-14 flex items-center";
            document.getElementById('modalMsg').textContent = `You said "${words[currentIndex].word}" perfectly!`;
            openModal();
            const utter = new SpeechSynthesisUtterance("Great job!");
            utter.pitch = 1.5;
            synth.speak(utter);
        }

        function handleFailure(heard) {
            feedbackEl.textContent = heard ? `I heard "${heard}". Try again!` : "Try again!";
            feedbackEl.className = "text-xl font-bold text-orange-500 text-center px-4 h-14 flex items-center";
        }

        function nextWord() {
            playClick();
            if (currentIndex < words.length - 1) {
                currentIndex++;
                updateDisplay();
            }
        }

        function prevWord() {
            playClick();
            if (currentIndex > 0) {
                currentIndex--;
                updateDisplay();
            }
        }

        function openModal() {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');
            modal.classList.remove('hidden');
            setTimeout(() => content.classList.add('scale-100'), 10);
        }

        function closeModal() {
            playClick();
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');
            content.classList.remove('scale-100');
            setTimeout(() => {
                modal.classList.add('hidden');
                nextWord();
            }, 300);
        }

        window.onload = updateDisplay;
    </script>
</body>
</html>

